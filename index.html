<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CineScope ¬∑ Free Movie Website</title>
  <meta name="description" content="A free, TMDb-powered movie website you can host on GitHub Pages." />
  <style>
    :root{
      --bg:#0b0f14; --card:#111826; --muted:#9aa4b2; --text:#e6ecf2; --accent:#5eead4; --accent-2:#60a5fa; --danger:#f43f5e;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,'Noto Sans',sans-serif;background:linear-gradient(180deg,#0a0e13,#0b0f14 40%);color:var(--text)}
    header{position:sticky;top:0;z-index:10;background:rgba(11,15,20,.85);backdrop-filter:blur(10px);border-bottom:1px solid #111827}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.5px}
    .brand .dot{width:10px;height:10px;border-radius:999px;background:linear-gradient(45deg,var(--accent),var(--accent-2))}
    .tools{display:grid;grid-template-columns:1fr auto auto;gap:10px;margin-top:12px}
    input[type="search"], select, button, .pill{
      background:var(--card);border:1px solid #1f2937;color:var(--text);padding:10px 12px;border-radius:12px;font-size:14px
    }
    input[type="search"]{width:100%}
    button{cursor:pointer}
    button.primary{background:linear-gradient(45deg,var(--accent-2),var(--accent));border:none;color:#051016;font-weight:700}
    button.ghost{background:transparent;border:1px solid #1f2937}
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .tabs .pill{cursor:pointer}
    .tabs .pill.active{border-color:transparent;background:linear-gradient(45deg,#1f2937,#0f172a)}

    main{max-width:1100px;margin:0 auto;padding:20px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:14px}
    .card{background:linear-gradient(180deg,#0d1420,#0b0f14);border:1px solid #172033;border-radius:16px;overflow:hidden;position:relative;transition:transform .2s ease, box-shadow .2s ease}
    .card:hover{transform:translateY(-2px);box-shadow:0 10px 20px rgba(0,0,0,.35)}
    .poster{width:100%;aspect-ratio:2/3;object-fit:cover;background:#0a0e13}
    .meta{padding:10px}
    .title{font-weight:700;font-size:14px;line-height:1.3;margin:6px 0 4px}
    .sub{color:var(--muted);font-size:12px}
    .badge{position:absolute;top:8px;left:8px;background:rgba(0,0,0,.6);padding:6px 8px;border-radius:999px;font-weight:700;font-size:12px}
    .wish{position:absolute;top:8px;right:8px;background:rgba(0,0,0,.5);border:1px solid #1f2937;border-radius:999px;padding:6px;cursor:pointer}

    .load-more{display:flex;justify-content:center;margin:24px 0}
    .empty{color:var(--muted);text-align:center;margin:50px 0}

    /* Modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.65);backdrop-filter:blur(6px);display:none;align-items:center;justify-content:center;padding:24px;z-index:50}
    .modal{width:min(900px,100%);background:linear-gradient(180deg,#0b1020,#0b0f14);border:1px solid #1f2937;border-radius:18px;overflow:hidden}
    .modal-head{display:grid;grid-template-columns:180px 1fr;gap:16px;padding:16px;border-bottom:1px solid #142033}
    .modal-body{padding:16px}
    .chip{display:inline-block;border:1px solid #1f2937;border-radius:999px;padding:6px 10px;margin:4px 6px 0 0;color:var(--muted);font-size:12px}
    .close{position:absolute;top:8px;right:8px;background:#0b0f14;border:1px solid #1f2937;border-radius:10px;padding:8px;cursor:pointer}
    iframe{width:100%;aspect-ratio:16/9;border:0;border-radius:12px}

    footer{max-width:1100px;margin:40px auto 80px;color:var(--muted);font-size:12px;padding:0 20px}
    a{color:#8ab4ff;text-decoration:none}
    .tmdb{display:flex;align-items:center;gap:8px;opacity:.85}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="brand"><span class="dot"></span> CineScope <span style="font-weight:400;color:var(--muted);font-size:13px">¬∑ Free & TMDb‚Äëpowered</span></div>
      <div class="tools">
        <input id="search" type="search" placeholder="Search movies (e.g., Inception)‚Ä¶" />
        <button id="clear" class="ghost" title="Clear search">Clear</button>
        <button id="trending" class="primary" title="Show trending">üî• Trending</button>
      </div>
      <div class="tabs">
        <span class="pill active" data-mode="trending">Trending</span>
        <span class="pill" data-mode="popular">Popular</span>
        <span class="pill" data-mode="now_playing">Now Playing</span>
        <span class="pill" data-mode="top_rated">Top Rated</span>
      </div>
    </div>
  </header>

  <main>
    <div id="grid" class="grid"></div>
    <div id="empty" class="empty" style="display:none">No movies found. Try a different search.</div>
    <div class="load-more"><button id="more" class="ghost">Load more</button></div>
  </main>

  <div id="backdrop" class="modal-backdrop" role="dialog" aria-modal="true">
    <div class="modal">
      <button class="close" id="close">‚úï</button>
      <div class="modal-head">
        <img id="mPoster" alt="Poster" class="poster"/>
        <div>
          <h2 id="mTitle" style="margin:6px 0 8px"></h2>
          <div id="mMeta" class="sub"></div>
          <div id="mGenres" style="margin-top:10px"></div>
          <div style="margin-top:10px"><button id="watchlistBtn" class="ghost">Ôºã Add to Watchlist</button></div>
        </div>
      </div>
      <div class="modal-body">
        <p id="mOverview" style="margin-top:0"></p>
        <div id="mCast" style="margin-top:8px"></div>
        <div id="mTrailerWrap" style="margin-top:16px"></div>
      </div>
    </div>
  </div>

  <footer>
    <div class="tmdb">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M12 0C5.373 0 0 5.373 0 12c0 6.627 5.373 12 12 12s12-5.373 12-12C24 5.373 18.627 0 12 0Zm5.333 17.333H6.667V6.667h10.666v10.666Z" fill="#01d277"/></svg>
      <span>This product uses the TMDb API but is not endorsed or certified by TMDb.</span>
    </div>
  </footer>

  <script>
    // =========================
    //  CONFIG ‚Äî REPLACE THIS!
    // =========================
    const TMDB_API_KEY = 'b16d644577d58436885f8430370de276'; // ‚Üê get one free at themoviedb.org
    // Optional: restrict adult content in searches
    const INCLUDE_ADULT = false;

    // ======= Helpers =======
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const BASE = 'https://api.themoviedb.org/3';
    const IMG = size => `https://image.tmdb.org/t/p/${size}`;
    const posterUrl = (path, size='w342') => path ? IMG(size) + path : '';

    let mode = 'trending'; // trending | popular | now_playing | top_rated | search
    let page = 1;          // current page for pagination
    let query = '';        // search query when mode === 'search'
    let loading = false;

    const grid = $('#grid');
    const moreBtn = $('#more');
    const emptyEl = $('#empty');

    function setActiveTab(next){
      $$('.tabs .pill').forEach(p=>p.classList.toggle('active', p.dataset.mode===next));
    }

    async function api(path, params={}){
      const url = new URL(BASE + path);
      url.searchParams.set('api_key', TMDB_API_KEY);
      Object.entries(params).forEach(([k,v])=> url.searchParams.set(k, v));
      const res = await fetch(url);
      if(!res.ok) throw new Error('API error ' + res.status);
      return res.json();
    }

    function formatYear(d){ return d ? (''+d).slice(0,4) : '‚Äî'; }

    function cardTpl(m){
      const y = formatYear(m.release_date);
      const rating = (m.vote_average||0).toFixed(1);
      const div = document.createElement('div');
      div.className = 'card';
      div.innerHTML = `
        <img class="poster" loading="lazy" src="${posterUrl(m.poster_path)}" alt="${m.title}">
        <div class="badge">‚≠ê ${rating}</div>
        <button class="wish" title="Add to watchlist">‚ô°</button>
        <div class="meta">
          <div class="title">${m.title||m.name}</div>
          <div class="sub">${y}</div>
        </div>`;
      div.addEventListener('click', (e)=>{
        if(e.target.closest('.wish')){ toggleWatchlist(m); e.stopPropagation(); return; }
        openModal(m.id, m);
      });
      return div;
    }

    function toggleWatchlist(m){
      const list = JSON.parse(localStorage.getItem('watchlist')||'[]');
      const i = list.findIndex(x=>x.id===m.id);
      if(i>-1){ list.splice(i,1); toast('Removed from Watchlist'); }
      else { list.push({id:m.id,title:m.title,poster:m.poster_path,year:formatYear(m.release_date)}); toast('Added to Watchlist'); }
      localStorage.setItem('watchlist', JSON.stringify(list));
    }

    let toastTimer; function toast(msg){
      clearTimeout(toastTimer);
      let t = document.getElementById('toast');
      if(!t){ t = document.createElement('div'); t.id='toast'; document.body.appendChild(t); }
      Object.assign(t.style,{position:'fixed',bottom:'20px',left:'50%',transform:'translateX(-50%)',background:'#111826',border:'1px solid #1f2937',padding:'10px 14px',borderRadius:'12px',zIndex:60});
      t.textContent = msg; t.style.opacity='1';
      toastTimer = setTimeout(()=> t.style.opacity='0', 1600);
    }

    async function load({append=false}={}){
      if(loading) return; loading = true; moreBtn.disabled = true; moreBtn.textContent='Loading‚Ä¶';
      try{
        let data;
        if(mode==='trending') data = await api('/trending/movie/week',{page});
        else if(mode==='popular') data = await api('/movie/popular',{page});
        else if(mode==='now_playing') data = await api('/movie/now_playing',{page});
        else if(mode==='top_rated') data = await api('/movie/top_rated',{page});
        else if(mode==='search') data = await api('/search/movie',{query, include_adult: INCLUDE_ADULT, page});

        const items = data.results||[];
        if(!append) grid.innerHTML='';
        items.forEach(m=> grid.appendChild(cardTpl(m)));
        emptyEl.style.display = (items.length===0 && page===1) ? 'block' : 'none';

        // if more pages exist, show Load more
        const max = data.total_pages||1;
        moreBtn.style.display = page < max ? 'inline-flex' : 'none';
      }catch(err){
        console.error(err); toast('Failed to load. Check API key.');
      }finally{
        moreBtn.disabled=false; moreBtn.textContent='Load more'; loading=false;
      }
    }

    // ===== Modal =====
    const backdrop = document.getElementById('backdrop');
    const closeBtn = document.getElementById('close');
    closeBtn.addEventListener('click', ()=> backdrop.style.display='none');
    backdrop.addEventListener('click', (e)=>{ if(e.target===backdrop) backdrop.style.display='none' });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') backdrop.style.display='none' });

    async function openModal(id, basics){
      backdrop.style.display='flex';
      try{
        const d = await api(`/movie/${id}`,{ append_to_response:'videos,credits' });
        const poster = posterUrl(d.poster_path,'w342');
        document.getElementById('mPoster').src = poster;
        document.getElementById('mTitle').textContent = d.title;
        const meta = [formatYear(d.release_date), `‚≠ê ${(d.vote_average||0).toFixed(1)}`, d.runtime? `${d.runtime} min`:'' ].filter(Boolean).join(' ¬∑ ');
        document.getElementById('mMeta').textContent = meta;
        document.getElementById('mGenres').innerHTML = (d.genres||[]).map(g=>`<span class="chip">${g.name}</span>`).join('');
        document.getElementById('mOverview').textContent = d.overview || 'No overview available.';
        const cast = (d.credits && d.credits.cast ? d.credits.cast.slice(0,6): []).map(c=>c.name).join(', ');
        document.getElementById('mCast').innerHTML = cast? `<span class="sub">Cast:</span> ${cast}` : '';
        const yt = (d.videos?.results||[]).find(v=> v.site==='YouTube' && (v.type==='Trailer' || v.type==='Teaser'));
        const wrap = document.getElementById('mTrailerWrap');
        wrap.innerHTML = yt ? `<iframe src="https://www.youtube.com/embed/${yt.key}" allowfullscreen title="Trailer"></iframe>` : '';
        document.getElementById('watchlistBtn').onclick = ()=> toggleWatchlist({id:d.id,title:d.title,poster:d.poster_path,release_date:d.release_date});
      }catch(e){ console.error(e); toast('Could not load details'); }
    }

    // ===== UI events =====
    $$('#header .pill'); // noop to ensure NodeList polyfill on some browsers
    $$('.tabs .pill').forEach(p=> p.addEventListener('click', ()=>{
      mode = p.dataset.mode; setActiveTab(mode); page = 1; query = ''; $('#search').value=''; load({append:false});
    }));

    $('#trending').addEventListener('click', ()=>{ mode='trending'; setActiveTab('trending'); page=1; query=''; $('#search').value=''; load({append:false}); });

    $('#clear').addEventListener('click', ()=>{ if($('#search').value){ $('#search').value=''; } mode='trending'; setActiveTab('trending'); page=1; query=''; load({append:false}); });

    $('#search').addEventListener('keydown', (e)=>{
      if(e.key==='Enter') doSearch();
    });

    function doSearch(){
      const q = $('#search').value.trim();
      if(!q){ mode='trending'; setActiveTab('trending'); page=1; query=''; load({append:false}); return; }
      mode='search'; query=q; page=1; setActiveTab(''); load({append:false});
    }

    moreBtn.addEventListener('click', ()=>{ page++; load({append:true}); });

    // ===== Kickoff =====
    if(!TMDB_API_KEY || TMDB_API_KEY==='YOUR_TMDB_API_KEY'){
      toast('Add your TMDb API key in the code!');
    }
    load();

    function setActiveTab(next){
      $$('.tabs .pill').forEach(p=>p.classList.toggle('active', p.dataset.mode===next));
    }
  </script>
</body>
</html>
